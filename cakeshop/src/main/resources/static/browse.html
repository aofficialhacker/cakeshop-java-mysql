<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Browse Cakes - Cake Shop</title>
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&family=Dancing+Script:wght@700&display=swap" rel="stylesheet">
  <!-- Bootstrap Icons CDN -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
  <!-- AOS Animation Library -->
  <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
  <!-- Favicon -->
  <link rel="icon" type="image/png" href="https://img.icons8.com/color/48/000000/cake.png">
  
  <!-- Embedded CSS -->
  <style>
    /* Global Reset */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    /* CSS Variables */
    :root {
      --primary-color: #FF6F61;
      --primary-hover: #E65A55;
      --secondary-color: #4A90E2;
      --background-color: #f9f9f9;
      --text-color: #333;
      --header-bg: #fff;
      --footer-bg: #333;
      --footer-text: #ccc;
      --accent-color: #FFB88C;
    }
    
    /* Base Styles */
    body {
      font-family: 'Poppins', sans-serif;
      background-color: var(--background-color);
      color: var(--text-color);
      line-height: 1.6;
    }
    .container {
      width: 90%;
      max-width: 1200px;
      margin: auto;
      padding: 0 15px;
    }
    
    /* Header */
    header {
      background-color: var(--header-bg);
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      position: sticky;
      top: 0;
      z-index: 100;
    }
    .header-container {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 15px 0;
    }
    .logo h1 {
      font-family: 'Dancing Script', cursive;
      font-size: 2rem;
      color: var(--primary-color);
    }
    .logo-text { font-weight: 600; }
    .logo-accent { font-weight: 700; color: var(--accent-color); }
    .main-nav ul {
      list-style: none;
      display: flex;
      gap: 20px;
    }
    .main-nav a {
      text-decoration: none;
      color: var(--text-color);
      font-weight: 500;
      transition: color 0.3s ease;
    }
    .main-nav a:hover, .main-nav a.active {
      color: var(--primary-color);
    }
    .user-info { font-size: 0.9rem; margin-right: 20px; }
    .cart-icon a {
      color: var(--text-color);
      position: relative;
      font-size: 1.5rem;
    }
    .cart-badge {
      position: absolute;
      top: -5px;
      right: -10px;
      background-color: var(--primary-color);
      color: #fff;
      padding: 2px 6px;
      border-radius: 50%;
      font-size: 0.75rem;
    }
    
    /* Browse Section */
    .browse-section {
      padding: 80px 0;
    }
    .browse-header {
      text-align: center;
      margin-bottom: 40px;
    }
    .browse-header .section-title {
      font-size: 2.5rem;
      margin-bottom: 10px;
      font-weight: 600;
    }
    .browse-header .highlight {
      color: var(--primary-color);
    }
    .browse-header .section-subtitle {
      font-size: 1rem;
      color: #777;
      margin-bottom: 20px;
    }
    
    /* Search Bar */
    .search-bar {
      display: flex;
      justify-content: center;
      margin-top: 20px;
    }
    .search-bar input {
      width: 300px;
      padding: 10px 15px;
      border: 1px solid #ddd;
      border-top-left-radius: 30px;
      border-bottom-left-radius: 30px;
      outline: none;
      font-size: 1rem;
    }
    .search-bar button {
      padding: 10px 20px;
      border: none;
      background-color: var(--primary-color);
      color: #fff;
      cursor: pointer;
      font-size: 1rem;
      border-top-right-radius: 30px;
      border-bottom-right-radius: 30px;
      transition: background-color 0.3s ease;
    }
    .search-bar button:hover {
      background-color: var(--primary-hover);
    }
    
    /* Filter & Sort Container */
    .filter-sort-container {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      align-items: center;
      gap: 20px;
      margin: 30px 0;
    }
    .filter-group, .sort-group {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .filter-group label, .sort-group label {
      font-size: 1rem;
      color: #555;
    }
    .filter-group select, .sort-group select {
      padding: 8px 12px;
      border: 1px solid #ddd;
      border-radius: 5px;
      font-size: 0.95rem;
      outline: none;
      background-color: #fff;
    }
    .filter-sort-container button {
      padding: 10px 20px;
      border: none;
      background-color: var(--primary-color);
      color: #fff;
      cursor: pointer;
      font-size: 1rem;
      border-radius: 30px;
      transition: background-color 0.3s ease;
    }
    .filter-sort-container button:hover {
      background-color: var(--primary-hover);
    }
    
    /* Cake List (Grid Layout) */
    .cake-list {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 30px;
    }
    .cake-card {
      background: #fff;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 4px 8px rgba(0,0,0,0.08);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    .cake-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 16px rgba(0,0,0,0.12);
    }
    .cake-image-container {
      position: relative;
      overflow: hidden;
    }
    .cake-card img {
      width: 100%;
      height: 200px;
      object-fit: cover;
      display: block;
    }
    .cake-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      opacity: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: opacity 0.3s ease;
    }
    .cake-image-container:hover .cake-overlay {
      opacity: 1;
    }
    .cake-info {
      padding: 15px;
    }
    .cake-info h3 {
      font-size: 1.2rem;
      color: var(--primary-color);
      margin-bottom: 8px;
    }
    .cake-info p {
      font-size: 0.9rem;
      color: #555;
      margin-bottom: 6px;
    }
    .add-to-cart-btn {
      background-color: var(--primary-color);
      color: #fff;
      border: none;
      padding: 10px 20px;
      border-radius: 30px;
      cursor: pointer;
      font-size: 1rem;
      transition: background-color 0.3s ease;
    }
    .add-to-cart-btn:hover {
      background-color: var(--primary-hover);
    }
    
    /* Footer */
    footer {
      background: var(--footer-bg);
      color: var(--footer-text);
      padding: 40px 0;
      font-size: 0.9rem;
    }
    .footer-content {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      margin-bottom: 20px;
    }
    .footer-logo h2 {
      font-family: 'Dancing Script', cursive;
      font-size: 2rem;
      color: var(--primary-color);
    }
    .footer-logo p { margin-top: 10px; }
    .footer-links ul { list-style: none; }
    .footer-links a {
      text-decoration: none;
      color: var(--footer-text);
      margin-bottom: 8px;
      display: block;
      transition: color 0.3s ease;
    }
    .footer-links a:hover { color: #fff; }
    .footer-social .social-icons a {
      font-size: 1.5rem;
      margin-right: 15px;
      color: var(--footer-text);
      transition: color 0.3s ease;
    }
    .footer-social .social-icons a:hover { color: #fff; }
    .footer-bottom {
      text-align: center;
      border-top: 1px solid #444;
      padding-top: 20px;
    }
    
    /* Responsive Styles */
    @media (max-width: 768px) {
      .header-container {
        flex-direction: column;
        align-items: center;
      }
      .main-nav ul {
        flex-direction: column;
        gap: 10px;
        margin-top: 15px;
      }
      .search-bar {
        flex-direction: column;
      }
      .search-bar input {
        width: 100%;
        border-radius: 30px;
        margin-bottom: 10px;
      }
      .search-bar button {
        width: 100%;
        border-radius: 30px;
      }
      .filter-sort-container {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
  <!-- Header with Navigation -->
  <header>
    <div class="container header-container">
      <div class="logo" data-aos="fade-right" data-aos-duration="800">
        <h1><span class="logo-text">Cake</span> <span class="logo-accent">Shop</span></h1>
      </div>
      <nav class="main-nav" data-aos="fade-down" data-aos-duration="800" data-aos-delay="200">
        <ul id="nav-links">
          <li><a href="index.html"><i class="bi bi-house-door-fill"></i> Home</a></li>
          <li><a href="browse.html" class="active"><i class="bi bi-grid-fill"></i> Browse Cakes</a></li>
          <li><a href="contact.html"><i class="bi bi-envelope-fill"></i> Contact</a></li>
          <!-- Dynamic auth links will be appended here by main.js -->
        </ul>
      </nav>
      <!-- User Info (if needed) -->
      <div id="user-info" class="user-info" data-aos="fade-left" data-aos-duration="800" data-aos-delay="300">
        <!-- Dynamically populated via JavaScript -->
      </div>
      <!-- Cart Icon with Badge -->
      <div class="cart-icon" data-aos="fade-left" data-aos-duration="800" data-aos-delay="400">
        <a href="cart.html" class="cart-button">
          <i class="bi bi-cart-fill"></i>
          <span id="cart-badge" class="cart-badge">0</span>
        </a>
      </div>
    </div>
  </header>
  
  <!-- Main Content -->
  <main>
    <section class="browse-section">
      <div class="container">
        <div class="browse-header" data-aos="fade-up" data-aos-duration="800">
          <h2 class="section-title">Browse Our <span class="highlight">Cakes</span></h2>
          <p class="section-subtitle">Find the perfect cake for your special occasion</p>
          <div class="search-bar" data-aos="fade-up" data-aos-duration="800" data-aos-delay="200">
            <input type="text" id="search-box" placeholder="Search cakes..." />
            <button onclick="applyFilters()">
              <i class="bi bi-search"></i> Search
            </button>
          </div>
        </div>
        <div class="filter-sort-container" data-aos="fade-up" data-aos-duration="800" data-aos-delay="300">
          <div class="filter-group">
            <label for="filter-select"><i class="bi bi-funnel-fill"></i> Filter by Price:</label>
            <select id="filter-select">
              <option value="">All Prices</option>
              <option value="under20">Under $20</option>
              <option value="20to40">$20 - $40</option>
              <option value="above40">Above $40</option>
            </select>
          </div>
          <div class="sort-group">
            <label for="sort-select"><i class="bi bi-sort-alpha-down"></i> Sort by:</label>
            <select id="sort-select">
              <option value="">Default</option>
              <option value="price-asc">Price: Low to High</option>
              <option value="price-desc">Price: High to Low</option>
              <option value="name-asc">Name: A to Z</option>
              <option value="name-desc">Name: Z to A</option>
            </select>
          </div>
          <button onclick="applyFilters()"><i class="bi bi-check2-circle"></i> Apply Filters</button>
        </div>
        <div id="cake-list" class="cake-list" data-aos="fade-up" data-aos-duration="800" data-aos-delay="400">
          <!-- Dynamically populated cake cards go here -->
        </div>
      </div>
    </section>
  </main>
  
  <!-- Footer -->
  <footer>
    <div class="container">
      <div class="footer-content">
        <div class="footer-logo" data-aos="fade-up" data-aos-duration="800">
          <h2><span class="logo-text">Cake</span> <span class="logo-accent">Shop</span></h2>
          <p>Delicious cakes for every occasion</p>
        </div>
        <div class="footer-links" data-aos="fade-up" data-aos-duration="800" data-aos-delay="200">
          <h3>Quick Links</h3>
          <ul>
            <li><a href="index.html">Home</a></li>
            <li><a href="browse.html">Browse Cakes</a></li>
            <li><a href="contact.html">Contact</a></li>
          </ul>
        </div>
        <div class="footer-social" data-aos="fade-up" data-aos-duration="800" data-aos-delay="400">
          <h3>Follow Us</h3>
          <div class="social-icons">
            <a href="#" aria-label="Facebook"><i class="bi bi-facebook"></i></a>
            <a href="#" aria-label="Instagram"><i class="bi bi-instagram"></i></a>
            <a href="#" aria-label="Twitter"><i class="bi bi-twitter"></i></a>
            <a href="#" aria-label="Pinterest"><i class="bi bi-pinterest"></i></a>
          </div>
        </div>
      </div>
      <div class="footer-bottom">
        <p>&copy; 2025 Cake Shop. All rights reserved.</p>
      </div>
    </div>
  </footer>
  
  <!-- Main JavaScript -->
  <script src="js/main.js"></script>
  <!-- AOS Animation Library -->
  <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
  <!-- Updated Browse JS -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // Call authentication functions from main.js
      checkAuth();
      updateNav();
      // Fetch cakes and update cart badge
      fetchCakes();
      updateCartBadge();
    });
    
    let cakes = [];
    
    // Fetch all cakes from the backend API
    function fetchCakes() {
      fetch('/api/cakes')
        .then(response => response.json())
        .then(data => {
          cakes = data;
          displayCakes(cakes);
        })
        .catch(error => console.error('Error fetching cakes:', error));
    }
    
    // Render cake cards using a modern, attractive layout with overlay effect
    function displayCakes(cakesToDisplay) {
      const cakeList = document.getElementById('cake-list');
      cakeList.innerHTML = '';
      cakesToDisplay.forEach(cake => {
        const cakeHTML = `
          <div class="cake-card" data-aos="fade-up" data-aos-duration="800">
            <div class="cake-image-container">
              <img src="${cake.photoUrl}" alt="${cake.name}" class="cake-image">
              <div class="cake-overlay">
                <button class="add-to-cart-btn" onclick="addToCart(${cake.id}, '${cake.name}', ${cake.price})">
                  <i class="bi bi-cart-plus"></i> Add to Cart
                </button>
              </div>
            </div>
            <div class="cake-info">
              <h3 class="cake-title">${cake.name}</h3>
              <p class="cake-description">${cake.description}</p>
              <p class="cake-price">â‚¹${cake.price}</p>
            </div>
          </div>
        `;
        cakeList.innerHTML += cakeHTML;
      });
    }
    
    // Function to add items to the cart and update the badge
    function addToCart(id, name, price) {
      let cart = JSON.parse(localStorage.getItem('cart')) || [];
      let existingItem = cart.find(item => item.id === id);
      if (existingItem) {
        existingItem.quantity++;
      } else {
        cart.push({ id, name, price, quantity: 1 });
      }
      localStorage.setItem('cart', JSON.stringify(cart));
      alert(`${name} added to cart.`);
      updateCartBadge();
    }
    
    // Update the cart badge with the total number of items
    function updateCartBadge() {
      let cart = JSON.parse(localStorage.getItem('cart')) || [];
      let totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
      document.getElementById('cart-badge').innerText = totalItems;
    }
    
    // Apply search, filter, and sort options
    function applyFilters() {
      const searchText = document.getElementById('search-box').value.toLowerCase();
      const filterValue = document.getElementById('filter-select').value;
      const sortValue = document.getElementById('sort-select').value;
    
      let filteredCakes = cakes.filter(cake => {
        return cake.name.toLowerCase().includes(searchText) ||
               cake.description.toLowerCase().includes(searchText);
      });
    
      if (filterValue) {
        filteredCakes = filteredCakes.filter(cake => {
          if (filterValue === 'under20') {
            return cake.price < 20;
          } else if (filterValue === '20to40') {
            return cake.price >= 20 && cake.price <= 40;
          } else if (filterValue === 'above40') {
            return cake.price > 40;
          }
          return true;
        });
      }
    
      if (sortValue) {
        if (sortValue === 'price-asc') {
          filteredCakes.sort((a, b) => a.price - b.price);
        } else if (sortValue === 'price-desc') {
          filteredCakes.sort((a, b) => b.price - a.price);
        } else if (sortValue === 'name-asc') {
          filteredCakes.sort((a, b) => a.name.localeCompare(b.name));
        } else if (sortValue === 'name-desc') {
          filteredCakes.sort((a, b) => b.name.localeCompare(a.name));
        }
      }
    
      displayCakes(filteredCakes);
    }
  </script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      AOS.init({
        once: false,
        mirror: true,
        duration: 1000,
        easing: 'ease-in-out'
      });
    });
  </script>
</body>
</html>
